<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Pyxcel</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />
    <script
      src="https://kit.fontawesome.com/e1004dd04e.js"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="../assets/vendor/animate.css/animate.min.css"
      rel="stylesheet"
    />
    <link href="../assets/vendor/aos/aos.css" rel="stylesheet" />
    <link
      href="../assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/boxicons/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link href="../assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link
      href="../assets/vendor/swiper/swiper-bundle.min.css"
      rel="stylesheet"
    />

    <link href="../assets/css/styles.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/styles-contenido.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/css/estilosDialogEvaluacion.css" />

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <header id="header" class="fixed-top">
      <div class="container d-flex align-items-center">
        <h1 class="logo me-auto"><a href="../index.html">Pyxcel</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html" class="logo me-auto"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->

        <nav id="navbar" class="navbar order-last order-lg-0">
          <ul>
            <li><a href="../index.html">Inicio</a></li>
            <li><a href="../index.html#about">Nosotros</a></li>
            <li><a class="active" href="nivel.html">Ver Curso</a></li>
          </ul>
          <i class="bi bi-list mobile-nav-toggle"></i>
        </nav>
        <!-- .navbar -->
        <div class="desplegable">
          <button class="desplebutton">
            <a href="#l" id="prueba" class="get-started-btn">
              cargando...
              <i class="fas fa-chevron-down"></i>
            </a>
          </button>
          <!-- <i class="material-icons">expand_more </i>  -->
          <div class="options">
            <a href="#" id="logout">Cerrar Sesion</a>
          </div>
        </div>
      </div>
    </header>
    <!-- End Header -->
    <!-- End Header -->

    <main class="main-pagina-contenido">
      <aside class="barra-menu">
        <h1>Temario</h1>
        <div class="poner-titulo-nivel">
          <template class="template-titulo-nivel">
            <h2>Nombre del Nivel</h2>
          </template>
        </div>
        <ul class="lista-temas">
          <template class="template-tema-nivel">
            <li class="tema-del-nivel"></li>
          </template>
        </ul>
        <div class="text-center">
          <button
            disabled="true"
            type="button"
            class="btn btn-danger btn-lg"
            data-toggle="modal"
            data-target="#modal_evaluacion"
            data-whatever="@mdo"
            id="rendirExamen"
            data-backdrop="static"
            data-keyboard="false"
          >
            Rendir Examen</button
          ><br /><br />
          <a href="nivel.html" type="button" class="btn btn-outline-success"
            >Volver al Curso</a
          ><br /><br />
        </div>
      </aside>
      <!--   barra-menu   -->
      <div class="contenidoTema-botones">
        <div class="seccion-contenido">
          <div class="titulo-del-contenido">
            <h1></h1>
          </div>

          <div class="informacion-contenido"></div>
        </div>
        <!--   seccion-contenido  -->

        <div class="seccion-botones">
          <div class="seccion-boton-anterior">
            <button class="boton-niveles boton-anterior">Anterior Tema</button>
          </div>
          <div class="seccion-boton-siguiente">
            <button class="boton-niveles boton-siguiente">
              Siguiente Tema
            </button>
          </div>
        </div>
        <!-- seccion-botones -->
      </div>

      <!--modal aprobado-->
      <div
        class="modal fade"
        id="modal_aprobado"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title" id="exampleModalLabel">
                Resultado de la prueba
              </h5>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-4">
                  <img src="../assets/img/aprobado.png" alt="" width="100px" />
                </div>
                <div class="col-8">
                  <div class="row">
                    <h1 class="text-success">Aprobado</h1>
                  </div>
                  <div class="row">
                    <h3 id="nota_evaluacion1" class="text-dark"></h3>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                id="botonsiguientenivel"
                type="button"
                class="btn btn-success btn-lg btn-block"
                data-bs-dismiss="modal"
              >
                Siguiente Nivel
              </button>
            </div>
          </div>
        </div>
      </div>
      <!--modal Reprobado-->
      <div
        class="modal fade"
        id="modal_reprobado"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-danger text-white">
              <h5 class="modal-title" id="exampleModalLabel">
                Resultado de la prueba
              </h5>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-4">
                  <img src="../assets/img/reprobado.png" alt="" width="100px" />
                </div>
                <div class="col-8">
                  <div class="row">
                    <h1 class="text-danger">Reprobado</h1>
                  </div>
                  <div class="row">
                    <h3 id="nota_evaluacion2" class="text-dark"></h3>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-danger btn-lg btn-block"
                data-bs-dismiss="modal"
                id="botonCerrarReprobado"
              >
                Cerrar
              </button>
            </div>
          </div>
        </div>
      </div>
      <!--Modal Evaluacion-->
      <div
        class="modal fade"
        id="modal_evaluacion"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog " role="document">
          <div class="modal-content">
            
            <div class="modal-header bg-success">
              
              <div class="col-10 well p-1 text-white" ><h4 id="tituloNivelLabel"> titulo</h4></div>
              
              <div class="col-2 well p-1" ><h5 id="temporizador" class="font-weight-bold text-white p-1 text-center" style="background-color: rgba(255, 0, 0, 0.5);
                border-radius: 7px;"></h5></div>
              
            </div>                  
            <div class="flexContainerpr container5pr">              
              <div class="flexItempr item1pr" id="TituloPregunta">item1</div>
            </div>
            <div class="modal-body">
              <div class="container-fluid">

                <div class="row p-1" style="display: flex; align-items: center; margin-top: -20px;">
                  <a
                    id="o1pregunta"
                    type="button"
                    class="btn btn-outline-light alert alert-success border border-dark"
                    style="white-space: normal; margin-bottom: 5px"
                    >Cargando...</a
                  >
                  <a
                    id="o2pregunta"
                    type="button"
                    class="btn btn-outline-light alert alert-success border border-dark"
                    style="white-space: normal; margin-bottom: 5px"
                    >Cargando...</a
                  >
                  <a
                    id="o3pregunta"
                    type="button"
                    class="btn btn-outline-light alert alert-success border border-dark"
                    style="white-space: normal; margin-bottom: 5px"
                    >Cargando...</a
                  >
                  <a
                    id="o4pregunta"
                    type="button"
                    class="btn btn-outline-light alert alert-success border border-dark"
                    style="white-space: normal; margin-bottom: 1px"
                    >Cargando...</a
                  >
                </div>
                
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                id="botonCancelarPrueba"
                class="btn btn-danger"
              >
                cancelar prueba
              </button>
              <!--button
                id="botonOmitirDialog"
                type="button"
                class="btn btn-warning"
              >
                omitir pregunta
              </button>-->
              <button
                type="button"
                id="close-modal"
                data-dismiss="modal"
                style="display: none"
              ></button>
            </div>
            <div class="progress" style="height: 5px;">
              <div id="bar" class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

          </div>
        </div>
      </div>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
      <script type="module">
        //CODIGO DE RECUPERACION DEL USUARIO
        import {
          initializeApp,
          onLog,
        } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
        import {
          getAuth,
          signOut,
          onAuthStateChanged,
          createUserWithEmailAndPassword,
          signInWithEmailAndPassword,
        } from "https:www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";
        //import { getDatabase} from "./connection-firebase";
        import {
          getDatabase,
          ref,
          get,
          set,
          child,
          update,
          remove,
          onChildAdded,
          onChildChanged,
          onChildRemoved,
        } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
        import { incializar } from "../assets/js/scrip.js";
        const firebaseConfig = {
          apiKey: "AIzaSyAd6JDsbBWEBv_UFCpgNi9zKEjqgiGytTE",
          authDomain: "pyxcel-d6df9.firebaseapp.com",
          databaseURL: "https://pyxcel-d6df9-default-rtdb.firebaseio.com",
          projectId: "pyxcel-d6df9",
          storageBucket: "pyxcel-d6df9.appspot.com",
          messagingSenderId: "953396754317",
          appId: "1:953396754317:web:321620a07c7577f5eb6fc4",
          measurementId: "G-46CQF62KX4",
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
          if (user) {
            const dbref = ref(getDatabase());
            get(child(dbref, "Usuarios/" + user.uid))
              .then((snapshot) => {
                console.log(user);
                if (snapshot.exists()) {
                  //const uid = user.email;
                  //console.log(uid)

                  let text = document.getElementById("prueba");
                  text.innerHTML =
                    snapshot.val().nombre +
                    '<i class="fas fa-chevron-down"></i>';
                  inicializarEvaluaciones(snapshot.val(), user.uid);
                  incializar(snapshot.val().nivelActual);
                  //console.log(snapshot.val().nivelActual);
                  //console.log(snapshot.val().nombre);
                  //recuperarNivelesUsuario(snapshot.val().nivelActual);
                } else {
                  console.log("No se encontro el elemento");
                }
              })
              .catch((error) => {
                console.log("unsucessfull, error" + error);
              });
          } else {
            // User is signed out
            console.log("me sali karen :D");
            window.location.href = "/index.html";
            // ...
          }

          const cont = document.getElementById("logout");

          cont.addEventListener("click", (e) => {
            signOut(auth);
          });
        });

        function inicializarEvaluaciones(datosUsuario, userid) {

          let listaPreguntas = new Array();

          const nivelActual = getParameterByName("id");
          console.log("mi id de la evaluacion es:"+nivelActual);
                function getParameterByName(name) {
                  name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                  var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
                  return results === null
                    ? ""
                    : decodeURIComponent(results[1].replace(/\+/g, " "));
                }
          get(child(ref(getDatabase()), "Evaluaciones/"+nivelActual)).then((snapshot) => {
            if (snapshot.exists()) {
                  snapshot.forEach((childSnapshot) => {
                  const childKey = childSnapshot.key;
                  const childData = childSnapshot.val();
                  console.log(childData);
                  listaPreguntas.push(childData);
                  console.log("lista actualizada");
                  console.log(listaPreguntas);
                  // ...
                });

               /*  console.log(snapshot);
                snapshot.forEach((data) => {
                console.log(data.key);
                console.log(data);});*/
            } else {
                alert("No se encontro el elemento");
              }
            })
              .catch((error) => {
                alert("unsucessfull, error" + error);
              });


          let preguntaActual = 1;
          let preguntasAleatoriasNum = generarOrdenPreguntas();
          function generarOrdenPreguntas() {
            const results = [];
            const limit = 10;
            while (results.length < limit) {
              const number = Math.floor(Math.random() * 20) + 1;
              if (!results.includes(number)) {
                results.push(number);
              }
            }
            console.log(results);
            return results;
          }
          let notaActual = 0;
          let pregunta = null;
          
          /*import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
        const firebaseConfig = {
          apiKey: "AIzaSyAd6JDsbBWEBv_UFCpgNi9zKEjqgiGytTE",
          authDomain: "pyxcel-d6df9.firebaseapp.com",
          projectId: "pyxcel-d6df9",
          storageBucket: "pyxcel-d6df9.appspot.com",
          messagingSenderId: "953396754317",
          appId: "1:953396754317:web:321620a07c7577f5eb6fc4",
          measurementId: "G-46CQF62KX4",
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        import {
          getDatabase,
          ref,
          get,
          set,
          child,
          update,
          remove,
          onChildAdded,
          onChildChanged,
          onChildRemoved,
        } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
		*/
          const db = getDatabase();
          const commentsRef = ref(db, "Evaluaciones/" + nivelActual);
          var contenido = "";

          /*var listaPreuntas = new Array();
			onChildAdded(commentsRef, (data) => {
				if (data.exists()) {
					//objeto recuperado (se ejecuta n veces hasta que termine de leer todos los niveles)
					const objeto = data.val();
					listaPreguntas.push(objeto);
					console.log(objeto);
				} else {
					alert("No se encontro el elemento");
				}

			});*/

      var textoCuenta = document.getElementById("temporizador");

          let op1pr = document.getElementById("o1pregunta");
          let op2pr = document.getElementById("o2pregunta");
          let op3pr = document.getElementById("o3pregunta");
          let op4pr = document.getElementById("o4pregunta");
          let tiPr = document.getElementById("TituloPregunta");
          let nuPr = document.getElementById("numeroPregunta");
          let tiNi = document.getElementById("tituloNivelLabel");
          let btnCeRe = document.getElementById("botonCerrarReprobado");

          let botonSigLevel = document.getElementById("botonsiguientenivel");
          botonSigLevel.addEventListener("click", function () {
            window.location.href = "nivel.html";
          });
          op1pr.textContent = "opcion 1";
          op2pr.textContent = "opcion 2";
          op3pr.textContent = "opcion 3";
          op4pr.textContent = "opcion 4";
          recuperarTituloNivel();
          btnCeRe.addEventListener("click", function () {
            notaActual = 0;
            preguntaActual = 1;
            preguntasAleatoriasNum = generarOrdenPreguntas();
            recuperarPreguntaSinTemporizador();
          });
          function recuperarTituloNivel() {
            const dbRef = ref(getDatabase());
            get(child(dbRef, "Niveles/" + nivelActual + "/titulo"))
              .then((snapshot) => {
                if (snapshot.exists()) {
                  //console.log(snapshot.val());

                  let titulo = snapshot.val();
                  tiNi.textContent = titulo;
                } else {
                  console.log("No data available");
                }
              })
              .catch((error) => {
                console.error(error);
              });
          }

          op1pr.addEventListener("click", function () {
            //op1pr.setAttribute("class", "btn btn-danger");
            //op1pr.disabled = true;
            //op2pr.disabled = true;
            //op3pr.disabled = true;
            //op4pr.disabled = true;
            verificarRespuestaPregunta(op1pr.textContent, "o1pregunta");
            setTimeout(recuperarPregunta, 200);
          });

          op2pr.addEventListener("click", function () {
            //op2pr.setAttribute("class", "btn btn-danger");
            //op1pr.disabled = true;
            //op2pr.disabled = true;
            //op3pr.disabled = true;
            //op4pr.disabled = true;
            verificarRespuestaPregunta(op2pr.textContent, "o2pregunta");
            setTimeout(recuperarPregunta, 200);
          });
          op3pr.addEventListener("click", function () {
            //op3pr.setAttribute("class", "btn btn-success");
            //op1pr.disabled = true;
            //op2pr.disabled = true;
            //op3pr.disabled = true;
            //op4pr.disabled = true;
            verificarRespuestaPregunta(op3pr.textContent, "o3pregunta");
            setTimeout(recuperarPregunta, 200);
          });
          op4pr.addEventListener("click", function () {
            //op4pr.setAttribute("class", "btn btn-danger");
            //op1pr.disabled = true;
            //op2pr.disabled = true;
            //op3pr.disabled = true;
            //op4pr.disabled = true;
            verificarRespuestaPregunta(op4pr.textContent, "o4pregunta");
            setTimeout(recuperarPregunta, 200);
          });

          function verificarRespuestaPregunta(respuestaActual, id_button) {
            if (recuperarPregunta === null && id_button === null) {
              mostrarNotaUsurioDialog();
              preguntaActual = 1;
            } else {
              var elem = document.getElementById(id_button);
              if (!(pregunta === null)) {
                if (preguntaActual < 11) {
                  if (respuestaActual === pregunta.respuesta) {
                    notaActual = notaActual + (100/listaPreguntas.length);

                    elem.className = "btn btn-success alert alert-success border border-dark";
                    console.log(
                      "Respuesta correcta, tu nora es: " + notaActual
                    );
                    //$('#modal_evaluacion').modal('hide'); // abrir
                    //$('#modal_aprobado').modal('show'); // abrir
                    const music = new Audio("../assets/audio/respcorrecto.mp3");
                    music.play(); /*
                music.loop =true;
                music.playbackRate = 2;
                music.pause();*/
                  } else {
                    console.log("Respuesta errónea, tu nota es: " + notaActual);
                    elem.className = "btn btn-danger alert alert-danger border border-dark";
                    const music = new Audio(
                      "../assets/audio/respincorrecto.mp3"
                    );
                    music.play();
                  }
                } else {
                  if (respuestaActual === pregunta.respuesta) {
                    notaActual = notaActual + (100/listaPreguntas.length);

                    elem.className = "btn btn-success";
                    console.log(
                      "Respuesta correcta, tu nora es: " + notaActual
                    );
                    //$('#modal_evaluacion').modal('hide'); // abrir
                    //$('#modal_aprobado').modal('show'); // abrir
                    const music = new Audio("../assets/audio/respcorrecto.mp3");
                    music.play(); /*
                music.loop =true;
                music.playbackRate = 2;
                music.pause();*/
                  } else {
                    console.log("Respuesta errónea, tu nota es: " + notaActual);
                    elem.className = "btn btn-danger";
                    const music = new Audio(
                      "../assets/audio/respincorrecto.mp3"
                    );
                    music.play();
                  }
                  console.log(preguntaActual);
                  if (preguntaActual === listaPreguntas.length+1) {
                    mostrarNotaUsurioDialog();
                    preguntaActual = 1;
                    //$('#myModalExito').modal('hide'); // cerrar
                  }
                }
              }
            }
          }

          function mostrarNotaUsurioDialog() {
            if (notaActual >= 60) {
              document.getElementById("close-modal").click();
              //document.getElementById('nota_evaluacion1').innerHTML=notaActual & "/100";
              $("#modal_aprobado").modal({
                backdrop: "static",
                keyboard: true,
                show: true,
              });
              $("#modal_aprobado").modal("show"); // abrir
              document.getElementById("nota_evaluacion1").innerHTML =
                notaActual + "/100";
              subirNotaBD(notaActual);
              //data-book-id=""
              //<input type="text" name="bookId" value=""/>
            } else {
              //subirNotaBD(notaActual);
              document.getElementById("close-modal").click();

              document.getElementById("nota_evaluacion2").innerHTML =
                notaActual + "/100";
              $("#modal_reprobado").modal({
                backdrop: "static",
                keyboard: true,
                show: true,
              });
              $("#modal_reprobado").modal("show"); // abrir

              document.getElementById("nota_evaluacion2").innerHTML =
                notaActual + "/100";
            }
          }

          function quitar_animacion_botones() {
            document.getElementById("o1pregunta").className =
              "btn btn-outline-light alert alert-success border border-dark";
            document.getElementById("o2pregunta").className =
              "btn btn-outline-light alert alert-success border border-dark";
            document.getElementById("o3pregunta").className =
              "btn btn-outline-light alert alert-success border border-dark";
            document.getElementById("o4pregunta").className =
              "btn btn-outline-light alert alert-success border border-dark";
          }

          let botonRendirExamen = document.getElementById("rendirExamen");
          botonRendirExamen.addEventListener("click", function () {
            reiniciarTemporizador();
            iniciarTemporizador();
          });

          console.log("datouserexiste");
          console.log(datosUsuario.notanivel1);
          console.log(datosUsuario["notanivel" + nivelActual]);
          if (
            datosUsuario["notanivel" + nivelActual] === undefined ||
            datosUsuario["notanivel" + nivelActual] === null
          ) {
            botonRendirExamen.disabled = false;
          } else {
            botonRendirExamen.textContent =
              "Nota: " + datosUsuario["notanivel" + nivelActual] + "/100";
            botonRendirExamen.disabled = true;
          }
          /*
        let botonOmitir = document.getElementById("botonOmitirDialog");
        botonOmitir.addEventListener("click", function () {
          const dbRef = ref(getDatabase());
				get(child(dbRef, "Evaluaciones/nivel1/p" + preguntaActual)).then((snapshot) => {
					if (snapshot.exists()) {
						console.log(snapshot.val());
						var pregunta = snapshot.val();
						nuPr.textContent = preguntaActual+"/15";
						preguntaActual = preguntaActual + 1;
						tiPr.textContent = pregunta.pregunta;
						op1pr.textContent = pregunta.o1;
						op2pr.textContent = pregunta.o2;
						op3pr.textContent = pregunta.o3;
						op4pr.textContent = pregunta.o4;
						//reiniciar e iniciar
					} else {
						console.log("No data available");
					}
				}).catch((error) => {
					console.error(error);
				});
          //pausarTemporizador();
          Swal.fire({
            title: "Realmente desea omitir la pregunta?",
            showCancelButton: true,
            confirmButtonText: "si omitir",
            cancelButtonText: "cancelar",
          }).then((result) => {
            // Read more about isConfirmed, isDenied below 
            if (result.isConfirmed) {
              //cerramos la vista y volvemos a niveles
              //no guardamos nada

              recuperarPregunta();
            } else {
              iniciarTemporizador();
            }
          });
        });
        */
          let botonCancelar = document.getElementById("botonCancelarPrueba");
          botonCancelar.addEventListener("click", function () {
            //pausarTemporizador();
            Swal.fire({
              title: "Realmente desea salir de la evaluacion?",
              showCancelButton: true,
              confirmButtonText: "si salir",
              cancelButtonText: "cancelar",
             
            }).then((result) => {
              // Read more about isConfirmed, isDenied below

              if (result.isConfirmed) {
                //cerramos la vista y volvemos a niveles
                //no guardamos nada
                //location.reload();

                //$("#modal_evaluacion.close").click()
                //$('#modal_evaluacion').modal('hide'); // abrir
                //$('#modal_evaluacion').removeClass('show');
                //$("#modal_evaluacion .close").click();
                //$('#modal_evaluacion').hide();

                //$('#cerrar').click();
                //$('.modal-backdrop').remove();

                $("#modal_evaluacion").modal().hide();
                $("body").removeClass("modal-open");
                $(".modal-backdrop").remove();

                document.getElementById("close-modal").click();
                preguntaActual = 1;
                preguntasAleatoriasNum = generarOrdenPreguntas();
                recuperarPreguntaSinTemporizador();
                notaActual = 0;

                //$('.modal').removeClass('shw');
                //$('modal-backdrop').remove();

                //$('.modal-backdrop').removeClass('in');
              } else {
                iniciarTemporizador();
              }
            });
          });

          recuperarPreguntaSinTemporizador();
          function recuperarPregunta() {
            quitar_animacion_botones();
            //console.log(snapshot.val());
            if (preguntaActual === listaPreguntas.length+1) {
                    verificarRespuestaPregunta(null, null);
                  } else {
                    pregunta = listaPreguntas[preguntaActual-1];
                    var progreso;
                    progreso= 100/listaPreguntas.length;
                    //nuPr.css('width', progreso + '%');
                    $('#bar').css('width', progreso + '%');
                    tiPr.textContent = pregunta.pregunta;
                    op1pr.textContent = pregunta.o1;
                    op2pr.textContent = pregunta.o2;
                    op3pr.textContent = pregunta.o3;
                    op4pr.textContent = pregunta.o4;
                    reiniciarTemporizador();
                    iniciarTemporizador();
                    preguntaActual = preguntaActual + 1;
                  }

            /* const dbRef = ref(getDatabase());
            get(
              child(
                dbRef,
                "Evaluaciones/nivel" +
                  nivelActual +
                  "/p" +
                  preguntasAleatoriasNum[preguntaActual - 1]
              )
            )
              .then((snapshot) => {
                if (snapshot.exists()) {
                  //console.log(snapshot.val());
                  if (preguntaActual === 11) {
                    verificarRespuestaPregunta(null, null);
                  } else {
                    pregunta = snapshot.val();
                    var progreso;
                    progreso= ((preguntaActual-1)/(100/listaPreguntas.length))*100;
                    //nuPr.css('width', progreso + '%');
                    $('#bar').css('width', progreso + '%');
                    tiPr.textContent = pregunta.pregunta;
                    op1pr.textContent = pregunta.o1;
                    op2pr.textContent = pregunta.o2;
                    op3pr.textContent = pregunta.o3;
                    op4pr.textContent = pregunta.o4;
                    reiniciarTemporizador();
                    iniciarTemporizador();
                    preguntaActual = preguntaActual + 1;
                  }
                  //reiniciar e iniciar
                } else {
                  console.log("No data available");
                  //preguntaActual = 15;
                  //verificarRespuestaPregunta();
                }
              })
              .catch((error) => {
                console.error(error);
              }); */
          }
          function recuperarPreguntaSinTemporizador() {

            pregunta = listaPreguntas[preguntaActual-1];
                  var progreso;
                  progreso= 100/listaPreguntas.length;
                  //nuPr.css('width', progreso + '%');
                  $('#bar').css('width', progreso + '%');
                  tiPr.textContent = pregunta.pregunta;
                  op1pr.textContent = pregunta.o1;
                  op2pr.textContent = pregunta.o2;
                  op3pr.textContent = pregunta.o3;
                  op4pr.textContent = pregunta.o4;
                  preguntaActual = preguntaActual + 1;
            
            /*
            const dbRef = ref(getDatabase());
            get(
              child(
                dbRef,
                "Evaluaciones/nivel" +
                  nivelActual +
                  "/p" +
                  preguntasAleatoriasNum[preguntaActual - 1] 
              )
            )
              .then((snapshot) => {
                if (snapshot.exists()) {
                  pregunta = snapshot.val();
                  var progreso;
                  progreso= ((preguntaActual-1)/10)*100;
                  //nuPr.css('width', progreso + '%');
                  $('#bar').css('width', progreso + '%');
                  tiPr.textContent = pregunta.pregunta;
                  op1pr.textContent = pregunta.o1;
                  op2pr.textContent = pregunta.o2;
                  op3pr.textContent = pregunta.o3;
                  op4pr.textContent = pregunta.o4;
                  preguntaActual = preguntaActual + 1;
                } else {
                  console.log("No data available");git 
                }
              })
              .catch((error) => {
                console.error(error);
              });*/
          }

          /*function siguientePregunta(){
				//let pregunta = listaPreuntas[preguntaActual];
				//preguntaActual = preguntaActual+1;
				//op1pr.textContent = pregunta.o1;
				//op2pr.textContent = pregunta.o2;
				//op3pr.textContent = pregunta.o3;
				//op4pr.textContent = pregunta.o4;
				console.log("hola");
				//console.log(pregunta.o1);
			}*/
          var segundos = 60;
          
          var cronometro;
          function iniciarTemporizador() {
            clearInterval(cronometro);
            cronometro = setInterval(function () {
              segundos = segundos - 1;
              textoCuenta.textContent = String(segundos);
              if (segundos === 0) {
                clearInterval(cronometro);
                setTimeout(function () {
                  if (preguntaActual === listaPreguntas.length+1) {
                    mostrarNotaUsurioDialog();
                  } else {
                    recuperarPregunta();
                  }
                  console.log("Tiempo terminadojh" + preguntaActual);
                }, 700);

                /*clearInterval(cronometro);
					recuperarPregunta();*/
              }
            }, 1000);
          }
          /*
        function pausarTemporizador() {
          clearInterval(cronometro);
        }
        */
          function reiniciarTemporizador() {
            segundos = 60;
            textoCuenta.textContent = String(segundos);
          }

          function subirNotaBD(nota) {
            //console.log(datosUsuario);
            console.log("Usuarios/" + userid + "/notanivel" + nivelActual);
            console.log("Usuarios/" + userid + "/nivelActual");
            set(
              ref(
                getDatabase(),
                "Usuarios/" + userid + "/notanivel" + nivelActual
              ),
              nota
            )
              .then(() => {
                //alert("Datos registrados correctamente");
              })
              .catch((error) => {
                //alert("unsucessfull, error" + error);
              });
            let nivelNuevo = parseInt(nivelActual) + 1;
            set(
              ref(getDatabase(), "Usuarios/" + userid + "/nivelActual"),
              nivelNuevo
            )
              .then(() => {
                //alert("Datos registrados correctamente");
              })
              .catch((error) => {
                //alert("unsucessfull, error" + error);
              });
          }
        }
      </script>
    </main>

    <script>
      /*function mensaje_alerta_omitir() {
			Swal.fire({
				title: 'Realmente desea omitir la pregunta?',
				showCancelButton: true,
				confirmButtonText: 'si omitir',
				cancelButtonText: 'cancelar',
			}).then((result) => {
			
				if (result.isConfirmed) {
					//cerramos la vista y volvemos a niveles
					//no guardamos nada

				}
			})
		}*/
      /*
		function mensaje_alerta_salir() {
			Swal.fire({
				title: 'Realmente desea salir de la efdasfdsavaluacion?',
				showCancelButton: true,
				confirmButtonText: 'si salir',
				cancelButtonText: 'cancelar',
			}).then((result) => {
		

				if (result.isConfirmed) {
					//cerramos la vista y volvemos a niveles
					//no guardamos nada
					location.reload();
				}
			})
		}*/
      /*function alerta() {
			var respuesta = confirm("Esta seguro que quiere salir de la prueba");
			if (respuesta == true) {
				return true;
			} else {
				return false;
			}
		}*/
    </script>

    <script
      src="../assets/js/libs/jquery.min.js"
      type="text/javascript"
    ></script>
    <script type="module" src="../assets/js/recover-data.js"></script>
    <script type="module" src="../assets/js/scrip.js"></script>
    <script type="module" src="../assets/js/connection-firebase.js"></script>

    <!-- Vendor JS Files -->
    <script src="../assets/vendor/aos/aos.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/vendor/php-email-form/validate.js"></script>
    <script src="../assets/vendor/purecounter/purecounter.js"></script>
    <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>

    <!--cdn botstrap-->
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <!-- cdn sweet alert-->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Template Main JS File -->
    <script src="../assets/js/main.js"></script>
  </body>
</html>
